function stickyfeatured(){

  var waypoint = new Waypoint({

    element: document.getElementsByClassName('show'),

    handler: function(direction) {
      $('.show').toggleClass('stuck', direction === 'down');
    },

    offset: 'bottom-in-view'

  })

}

$(document).ready(function($) {

  $('#home--recent-slider').royalSlider({
    arrowsNav: false,
    arrowsNavAutoHide: false,
    controlNavigationSpacing: 0,
    controlNavigation: 'none',
    imageAlignCenter:false,
    blockLoop: true,
    loop: true,
    autoHeight: true,
    keyboardNavEnabled: true,
    addActiveClass: true,
    visibleNearby: {
      enabled: true,
      centerArea: 0.95,
      center: true,
      breakpoint: 650,
      breakpointCenterArea: 1,
      navigateByCenterClick: true
    }
  });

  var slider = $('#home--recent-slider').data('royalSlider');

  $('#home--recent .arrow-left').on('click', function(event){
    event.preventDefault();
    slider.prev();
  });

  $('#home--recent .arrow-right').on('click', function(event){
    event.preventDefault();
    slider.next();
  });

});

$(document).ready(function(){

  $('#home--above').royalSlider({
    arrowsNav: true,
    arrowsNavAutoHide: false,
    fadeinLoadedSlide: false,
    controlNavigationSpacing: 0,
    controlNavigation: 'bullets',
    imageScaleMode: 'none',
    imageAlignCenter:false,
    blockLoop: true,
    loop: true,
    numImagesToPreload: 6,
    transitionType: 'fade',
    keyboardNavEnabled: true,
    autoHeight: true,
    block: {
      delay: 400
    },
    autoPlay: {
      // autoplay options go gere
      enabled: true,
      pauseOnHover: true
    }
  });

  var slider = $('#home--above').data('royalSlider');

  $('#home--above .arrow-left').on('click', function(event){
    event.preventDefault();
    slider.prev();
  });

  $('#home--above .arrow-right').on('click', function(event){
    event.preventDefault();
    slider.next();
  });

});

function swap() {

 $('.btn-moreinfo').magnificPopup({
   type: 'iframe',
   iframe: {
     markup: '<div id="home--content" class="mfp-iframe-scaler">'+
             '<div id="home--content-close" class="mfp-close ss-icon ss-plus"></div>'+
             '<a id="home--content-newwindow" class="ss-gizmo ss-expand" target="blank"></a>'+
             '<div id="home--content-loading"></div>'+
             '<iframe style="opacity:0;max-width:100%" class="mfp-iframe" frameborder="0" allowfullscreen></iframe>'+
             '</div>',
   },
   callbacks: {
     open: function() {
        
       var magnificPopup = $.magnificPopup.instance,
                     cur = magnificPopup.st.el;
                     link = cur.attr('href');
       if (link=='') {
        $('#home--content-newwindow').hide();
       } else {
        $('#home--content-newwindow').attr('href',link);
       }
       setTimeout(function(){
         $("#home--content").addClass('fs-swap-active');
         $("#wrapper").addClass('fs-swap-active');
       },200);
       setTimeout(function(){
         $("#home--content-loading").transition({opacity:0},300);
         $(".mfp-iframe").transition({opacity:1},300);
       },1500);
     },
     beforeClose: function() {
      $("#home--content").removeClass('fs-swap-active');
      $("#wrapper").removeClass('fs-swap-active');
     }
   }
 });

}

swap();

function videos(){
	$('.popup-video').magnificPopup({
	    //delegate: 'a',
	    type: 'inline',
	    callbacks: {
	        open: function() {

	            // https://github.com/dimsemenov/Magnific-Popup/issues/125
	            //$('html').css('margin-right', 0);

	            // Play video on open:
	            //$(this.content).find('video')[0].play();

	        },
	        close: function() {

	            // Reset video on close:
	            //$(this.content).find('video')[0].load();

	        }
	    }
	});
}

videos();

$(window).resize(function(){

// $('.video-popup video').each(function() {

// 	var ww    = $(window).width();
// 	var vh    = $(this).attr('height');
// 	var vw    = $(this).attr('width');
// 	var vrw   = $(this).width();
// 	var ogh   = 720;
// 	var ogw   = 1280;
// 	var ratio = 720/1280;
// 	var calc  = vrw*ratio;

// 	$('.video-popup video').attr('width', ww-16).attr('height', calc);

// });


}).resize();

function smoothScroll(){
  $(function() {
    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({
            scrollTop: target.offset().top - 75
          }, 400);
          return false;
        }
      }
    });
  });
}

smoothScroll();

// @codekit-prepend "featured.js"
// @codekit-prepend "slider.js"
// @codekit-prepend "slider_main.js"
// @codekit-append  "miles.js"
// @codekit-prepend "moreinfo.js"
// @codekit-prepend "videos.js"
// @codekit-prepend "_smoothscroll.js"

function sidebarSizing(){
  $(window).resize(function(){
    var sw = $('#home--shows aside').width();
    $('#sidebar-sticky').css({
      width: sw,
    });
  });

}

function equalized(){

  $("#home--shows").equalize({
    target: ".sizer-item"
  });

  if( $('#sidebar-sticky').length ) {
    var sticky = new Waypoint.Sticky({
      element: $('#sidebar-sticky')[0],
      offset: 80,
    });
  }

  sidebarSizing();
  $(window).resize();

}

function showClick(){

  var d= 0;

  $(".show").not(this).each(function() {
    $(this).delay(d).transition({opacity:0,});
    d += 150;
  });

  setTimeout(function(){
    $(".show").removeAttr( "style" );
  },1500);

}

function headerjunk(){

  var options = {
    classes: {
      clone:   'banner--clone',
      stick:   'banner--stick',
      unstick: 'banner--unstick'
    },
     offset: 100,
  };
  var banner = new Headhesive('#header', options);

}

$(function(){

  $(".toggle").swap();

  $(".content, #page--video, .video-popup").fitVids();
  $(".tab").tabs({
    mobileMaxWidth: '300px'
  });

  setTimeout(function(){
    $('.overlay').removeClass('active');
  },500);

  headerjunk();
  

  $("#home--shows").imagesLoaded( function() {
    equalized();
  });

  $(".show").click(function(event){
    //event.preventDefault();
    //showClick();
  });

  addthisevent.settings({
    css : false,
  });

  $(function() {
    $('a[href*=#]:not([href=#])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html,body').animate({
            scrollTop: target.offset().top - 80
          }, 1000);
          return false;
        }
      }
    });
  });


});

jQuery(document).ready(function() {
// Are we on a show page
	if($("#page--related-feed").length == 1) {
		$("#page--related-feed").css('opacity','0');
			jQuery.get(
				ajaxurl,{
					'action': 'load_redbull',
					'data':   page_id
				},
				function(response){

					$("#page--related .loading").fadeOut(300);

					setTimeout(function(){

						$("#page--related-feed").html(response).transition({
							opacity:1
						});

						$("#page--related").equalize({
	    					target: ".feed-item"
	    				});

					},1000);



				}
			);
	}
});

